[gd_scene load_steps=4 format=3 uid="uid://main_scene"]

[ext_resource type="Script" path="res://scripts/ui/hud.gd" id="1"]
[ext_resource type="PackedScene" path="res://scenes/ui/game_menu.tscn" id="2"]

[sub_resource type="GDScript" id="1"]
script/source = "extends Node

## DEV MODE: Skip all menus, create random character, load directly into game

func _ready() -> void:
	call_deferred(\"_dev_quick_start\")

func _dev_quick_start() -> void:
	# Reset game state
	GameManager.reset_for_new_game()
	InventoryManager.reset_for_new_game()
	QuestManager.reset_for_new_game()
	SaveManager.reset_world_state()

	# Create random character
	var char_data := CharacterData.new()

	# Random race
	var races := [Enums.Race.HUMAN, Enums.Race.ELF, Enums.Race.DWARF, Enums.Race.HALFLING]
	char_data.race = races[randi() % races.size()]

	# Random name
	var names := {
		Enums.Race.HUMAN: [\"Aldric\", \"Bran\", \"Caden\", \"Elena\", \"Freya\"],
		Enums.Race.ELF: [\"Aelindra\", \"Caelum\", \"Lyria\", \"Thalas\"],
		Enums.Race.DWARF: [\"Thorin\", \"Gimrik\", \"Bolin\", \"Helga\"],
		Enums.Race.HALFLING: [\"Pippin\", \"Merry\", \"Rosie\", \"Bramble\"]
	}
	var race_names: Array = names.get(char_data.race, [\"Stranger\"])
	char_data.character_name = race_names[randi() % race_names.size()]

	# Apply racial bonuses
	char_data.initialize_race_bonuses()

	# Random bonus stats
	var stats := [\"grit\", \"agility\", \"will\", \"speech\", \"knowledge\", \"vitality\"]
	for i in range(5):
		var stat: String = stats[randi() % stats.size()]
		char_data.set(stat, char_data.get(stat) + 1)

	# Set as active character and apply dev stats
	GameManager.player_data = char_data
	GameManager.apply_dev_stats(char_data)

	# Starting gear
	InventoryManager.add_item(\"iron_sword\", 1)
	InventoryManager.add_item(\"health_potion\", 3)
	InventoryManager.add_item(\"lockpick\", 5)
	InventoryManager.add_gold(100)

	print(\"[DEV] Quick start: %s the %s\" % [char_data.character_name, Enums.Race.keys()[char_data.race]])

	# Load game
	get_tree().change_scene_to_file(\"res://scenes/levels/dalhurst.tscn\")
"

[node name="Main" type="Node"]
script = SubResource("1")

[node name="HUD" type="CanvasLayer" parent="."]
script = ExtResource("1")
health_bar = NodePath("HUDContainer/HealthBar")
health_label = NodePath("HUDContainer/HealthBar/HealthLabel")
stamina_bar = NodePath("HUDContainer/StaminaBar")
spell_slots_container = NodePath("HUDContainer/SpellSlots")
quick_slots_container = NodePath("HUDContainer/QuickSlots")
enemy_health_container = NodePath("HUDContainer/EnemyHealth")
enemy_health_bar = NodePath("HUDContainer/EnemyHealth/EnemyHealthBar")
enemy_name_label = NodePath("HUDContainer/EnemyHealth/EnemyName")
notification_label = NodePath("HUDContainer/NotificationLabel")
crosshair = NodePath("HUDContainer/Crosshair")
gold_label = NodePath("HUDContainer/GoldLabel")
time_label = NodePath("HUDContainer/TimeLabel")

[node name="HUDContainer" type="Control" parent="HUD"]
layout_mode = 3
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2

[node name="HealthBar" type="ProgressBar" parent="HUD/HUDContainer"]
layout_mode = 1
anchors_preset = 0
offset_left = 16.0
offset_top = 16.0
offset_right = 216.0
offset_bottom = 32.0
value = 100.0
show_percentage = false

[node name="HealthLabel" type="Label" parent="HUD/HUDContainer/HealthBar"]
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
text = "100 / 100"
horizontal_alignment = 1
vertical_alignment = 1

[node name="StaminaBar" type="ProgressBar" parent="HUD/HUDContainer"]
layout_mode = 1
anchors_preset = 0
offset_left = 16.0
offset_top = 36.0
offset_right = 216.0
offset_bottom = 48.0
value = 100.0
show_percentage = false

[node name="SpellSlots" type="HBoxContainer" parent="HUD/HUDContainer"]
layout_mode = 1
anchors_preset = 0
offset_left = 16.0
offset_top = 52.0
offset_right = 216.0
offset_bottom = 72.0

[node name="QuickSlots" type="HBoxContainer" parent="HUD/HUDContainer"]
layout_mode = 1
anchors_preset = 2
anchor_top = 1.0
anchor_bottom = 1.0
offset_left = 16.0
offset_top = -80.0
offset_right = 232.0
offset_bottom = -16.0
grow_vertical = 0

[node name="EnemyHealth" type="Control" parent="HUD/HUDContainer"]
visible = false
layout_mode = 1
anchors_preset = 5
anchor_left = 0.5
anchor_right = 0.5
offset_left = -150.0
offset_top = 16.0
offset_right = 150.0
offset_bottom = 64.0
grow_horizontal = 2

[node name="EnemyName" type="Label" parent="HUD/HUDContainer/EnemyHealth"]
layout_mode = 1
anchors_preset = 10
anchor_right = 1.0
offset_bottom = 20.0
grow_horizontal = 2
horizontal_alignment = 1

[node name="EnemyHealthBar" type="ProgressBar" parent="HUD/HUDContainer/EnemyHealth"]
layout_mode = 1
anchors_preset = 10
anchor_right = 1.0
offset_top = 24.0
offset_bottom = 40.0
grow_horizontal = 2
value = 100.0
show_percentage = false

[node name="Crosshair" type="CenterContainer" parent="HUD/HUDContainer"]
layout_mode = 1
anchors_preset = 8
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
grow_horizontal = 2
grow_vertical = 2

[node name="CrosshairDot" type="ColorRect" parent="HUD/HUDContainer/Crosshair"]
custom_minimum_size = Vector2(4, 4)
layout_mode = 2
color = Color(1, 1, 1, 0.8)

[node name="GoldLabel" type="Label" parent="HUD/HUDContainer"]
layout_mode = 1
anchors_preset = 1
anchor_left = 1.0
anchor_right = 1.0
offset_left = -120.0
offset_top = 16.0
offset_right = -16.0
offset_bottom = 36.0
grow_horizontal = 0
text = "300 G"
horizontal_alignment = 2

[node name="TimeLabel" type="Label" parent="HUD/HUDContainer"]
layout_mode = 1
anchors_preset = 1
anchor_left = 1.0
anchor_right = 1.0
offset_left = -120.0
offset_top = 40.0
offset_right = -16.0
offset_bottom = 60.0
grow_horizontal = 0
text = "8:00 AM"
horizontal_alignment = 2

[node name="NotificationLabel" type="Label" parent="HUD/HUDContainer"]
layout_mode = 1
anchors_preset = 5
anchor_left = 0.5
anchor_right = 0.5
offset_left = -200.0
offset_top = 100.0
offset_right = 200.0
offset_bottom = 120.0
grow_horizontal = 2
horizontal_alignment = 1

[node name="GameMenu" parent="HUD" instance=ExtResource("2")]
visible = false
